generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
  url = env("DATABASE_URL")
}

enum PartnerOrganization {
  ELEVANCEHEALTH
  HUMANA
}

enum CareTaskType {
  DEXA_SCAN
  MAMMOGRAM
}

enum CareTaskStatus {
  CANCELLED
  COMPLETED
  PENDING
  SCHEDULED
}

enum CareTaskEventType {
  PATIENT_ONBOARDING_CALL
}

enum CareTaskEventStatus {
  INITIATED
  SUCCESS
  FAILED
  VOICEMAIL
}

enum EventResultType {
  QUESTION
  OTHER
  VERIFICATION
}

enum OutreachChannel {
  EMAIL
  SMS
  PHONE
}

model Patient {
  birthDate           DateTime @db.Date
  createdAt           DateTime @default(now())
  emailAddress        String?
  externalId          String @unique
  familyName          String
  givenName           String
  id                  String   @id @default(uuid())
  metadata            Json
  optedOutChannels    PatientOptOut[]
  partnerOrganization PartnerOrganization
  phoneNumber         String
  tasks               CareTask[]
  timezone            String
  updatedAt           DateTime @updatedAt
}

model PatientOptOut {
  createdAt DateTime        @default(now())
  id        String          @id @default(uuid())
  patient   Patient         @relation(fields: [patientId], references: [id])
  patientId String
  channel   OutreachChannel
}

model CareTask {
  createdAt DateTime        @default(now())
  events    CareTaskEvent[]
  id        String          @id @default(uuid())
  patient   Patient         @relation(fields: [patientId], references: [id])
  patientId String
  status    CareTaskStatus  @default(PENDING)
  type      CareTaskType
  updatedAt DateTime        @updatedAt
}

model CareTaskEvent {
  createdAt     DateTime        @default(now())
  eventType     CareTaskEventType
  externalId    String?
  failureReason String?
  id            String          @id @default(uuid())
  results       EventResult[]
  status        CareTaskEventStatus
  task          CareTask        @relation(fields: [taskId], references: [id])
  taskId        String
  updatedAt     DateTime        @updatedAt
}

model EventResult {
  createdAt DateTime        @default(now())
  id        String          @id @default(uuid())
  type      EventResultType
  eventId   String
  event     CareTaskEvent @relation(fields: [eventId], references: [id])
  key       String
  value     String
  updatedAt DateTime        @updatedAt
  metadata  Json @default("{}")
}
